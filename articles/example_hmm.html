<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="See the {ino} package in action for the HMM likelihood optimization.
">
<title>Example: Hidden Markov Model • ino</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Example: Hidden Markov Model">
<meta property="og:description" content="See the {ino} package in action for the HMM likelihood optimization.
">
<meta property="og:image" content="https://loelschlaeger.de/ino/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ino</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/ino.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/example_hmm.html">Example: Hidden Markov Model</a>
    <a class="dropdown-item" href="../articles/example_probit.html">Example: Probit Model</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/loelschlaeger/ino/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Example: Hidden Markov Model</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/loelschlaeger/ino/blob/HEAD/vignettes/example_hmm.Rmd" class="external-link"><code>vignettes/example_hmm.Rmd</code></a></small>
      <div class="d-none name"><code>example_hmm.Rmd</code></div>
    </div>

    
    
<p>In this vignette<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;The vignette was build using R 4.3.0 with the
&lt;a href="https://github.com/loelschlaeger/ino" class="external-link"&gt;ino&lt;/a&gt; 1.0.0 package.&lt;/p&gt;'><sup>1</sup></a> we describe the workflow of the
<a href="https://github.com/loelschlaeger/ino" class="external-link">ino</a> package for fitting a hidden Markov model (HMM)
through likelihood optimization. HMMs are statistical models used to
explain systems that can only be observed indirectly through a sequence
of outputs, and have unobservable hidden states. They consist of two
processes, a Markov process that describes the hidden states, and an
observable process that describes the outputs produced by the system,
where the probability of observing an output at a given time depends
only on the current state. State-switching models like HMMs are commonly
used in speech recognition, animal movement modeling, bioinformatics,
and finance. For more technical details about HMMs and their scope of
application, see, e.g., <span class="citation">Zucchini, MacDonald, and
Langrock (<a href="#ref-Zucchini:2016" role="doc-biblioref">2016</a>)</span>.</p>
<div class="section level2">
<h2 id="application-to-financial-data">Application to financial data<a class="anchor" aria-label="anchor" href="#application-to-financial-data"></a>
</h2>
<p>The example data set considered throughout this vignette covers a
time series of log returns from the <a href="https://en.wikipedia.org/wiki/DAX" class="external-link">German stock index DAX</a> over
30 years. The DAX closing prices are freely accessible via Yahoo Finance
and can be downloaded via the <code><a href="https://loelschlaeger.de/fHMM/reference/download_data.html" class="external-link">download_data()</a></code> function from
the <a href="https://loelschlaeger.de/fHMM/" class="external-link">fHMM</a> package <span class="citation">(<a href="#ref-Oelschl%C3%A4ger:2023b" role="doc-biblioref">Oelschläger, Adam,
and Michels 2023</a>)</span>. They can easily be transformed to log
returns using the <a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a> package <span class="citation">(<a href="#ref-Wickham:2023" role="doc-biblioref">Wickham et al. 2023</a>)</span>:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://loelschlaeger.de/fHMM/" class="external-link">"fHMM"</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://dplyr.tidyverse.org" class="external-link">"dplyr"</a></span><span class="op">)</span></span>
<span><span class="va">dax</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://loelschlaeger.de/fHMM/reference/download_data.html" class="external-link">download_data</a></span><span class="op">(</span>symbol <span class="op">=</span> <span class="st">"^GDAXI"</span>, from <span class="op">=</span> <span class="st">"1990-01-01"</span>, to <span class="op">=</span> <span class="st">"2020-01-01"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/reframe.html" class="external-link">reframe</a></span><span class="op">(</span></span>
<span>    date <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html" class="external-link">as.Date</a></span><span class="op">(</span><span class="va">Date</span>, format <span class="op">=</span> <span class="st">"%Y-%m-%d"</span><span class="op">)</span>,</span>
<span>    logreturn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fu"><a href="https://rdrr.io/r/base/diff.html" class="external-link">diff</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">Close</span><span class="op">)</span>, lag <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">logreturn</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 7,475 × 2</span></span></span>
<span><span class="co">#&gt;    date       logreturn</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;date&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> 1990-01-03  0.042<span style="text-decoration: underline;">9</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> 1990-01-04 -<span style="color: #BB0000;">0.019</span><span style="color: #BB0000; text-decoration: underline;">7</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> 1990-01-05 -<span style="color: #BB0000;">0.009</span><span style="color: #BB0000; text-decoration: underline;">89</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> 1990-01-08  0.015<span style="text-decoration: underline;">6</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> 1990-01-09  0.013<span style="text-decoration: underline;">0</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> 1990-01-10 -<span style="color: #BB0000;">0.012</span><span style="color: #BB0000; text-decoration: underline;">1</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> 1990-01-11  0.000<span style="text-decoration: underline;">201</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> 1990-01-12  0.009<span style="text-decoration: underline;">47</span> </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> 1990-01-15 -<span style="color: #BB0000;">0.011</span><span style="color: #BB0000; text-decoration: underline;">1</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> 1990-01-16 -<span style="color: #BB0000;">0.018</span><span style="color: #BB0000; text-decoration: underline;">8</span>  </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 7,465 more rows</span></span></span></code></pre></div>
<p>The time series looks as follows:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://ggplot2.tidyverse.org" class="external-link">"ggplot2"</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">dax</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">date</span>, y <span class="op">=</span> <span class="va">logreturn</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_date.html" class="external-link">scale_x_date</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_percent.html" class="external-link">label_percent</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/hmm-plot-dax-data-1.png" width="75%" style="display: block; margin: auto;"></p>
<p>As the log returns are continuous and can take both negative and
positive values, we consider an HMM with Gaussian state-dependent
distributions — note that some applications instead use t-distributions
to also model the kurtosis <span class="citation">(<a href="#ref-Oelschl%C3%A4ger:2021" role="doc-biblioref">Oelschläger and Adam
2021</a>)</span>.</p>
</div>
<div class="section level2">
<h2 id="likelihood-optimization">Likelihood optimization<a class="anchor" aria-label="anchor" href="#likelihood-optimization"></a>
</h2>
<p>We consider a 2-state (<code>N = 2</code>) Gaussian-HMM here to model
bearish and bullish market periods. This results in six parameters
(<code>npar = 6</code>) to be estimated:</p>
<ul>
<li>two identified parameters for the transition probability matrix
(t.p.m.),</li>
<li>two for the means of the state-dependent distributions,</li>
<li>two for the standard deviations of the state-dependent
distributions.</li>
</ul>
<p>The likelihood for a Gaussian-HMM is given by the function
<code><a href="../reference/f_ll_hmm.html">f_ll_hmm()</a></code> provided by the <a href="https://github.com/loelschlaeger/ino" class="external-link">ino</a> package. The
argument <code>neg = TRUE</code> indicates that we minimize the negative
log-likelihood, and <code>set_optimizer(optimizer_nlm())</code> selects
the optimizer <code><a href="https://rdrr.io/r/stats/nlm.html" class="external-link">stats::nlm()</a></code> (see the introductory vignette
for more details on how to specify optimizers).</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hmm_ino</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Nop.html">Nop</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span></span>
<span>  f <span class="op">=</span> <span class="va">f_ll_hmm</span>, </span>
<span>  npar <span class="op">=</span> <span class="fl">6</span>, </span>
<span>  data <span class="op">=</span> <span class="va">dax</span><span class="op">$</span><span class="va">logreturn</span>, </span>
<span>  N <span class="op">=</span> <span class="fl">2</span>, </span>
<span>  neg <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span><span class="op">$</span></span>
<span><span class="fu">set_optimizer</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/optimizeR/man/define_optimizer.html" class="external-link">optimizer_nlm</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="random-initialization">Random initialization<a class="anchor" aria-label="anchor" href="#random-initialization"></a>
</h3>
<p>Randomly chosen starting values is a first initialization
approach:</p>
<ul>
<li>As the first two starting values belong to the off-diagonal of the
t.p.m., we draw starting values from a <span class="math inline">\(\mathcal{U}(-2,-1)\)</span> distribution — as we
use the multinomial logit link to ensure that the probabilities are
between 0 and 1, a value of -1.5 correspond to probabilities of staying
in state 1 or 2 of about 80%.</li>
<li>For the two means, we draw two random numbers from the standard
normal distribution, as the time series above indicates that the most of
the returns are fairly close to zero.</li>
<li>The starting values for the standard deviations are drawn from a
<span class="math inline">\(\mathcal{U}(0.5,2)\)</span> distribution
(note that we exponentiate the standard deviations in the likelihood as
they are constrained to be positive, and hence we log-transform the
starting values).</li>
</ul>
<p>The <code>$optimize()</code> method with argument
<code>initial = sampler</code> then performs <code>runs = 100</code>
optimization runs with starting values drawn from the specified
distributions:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sampler</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">2</span>, <span class="op">-</span><span class="fl">2</span>, <span class="op">-</span><span class="fl">1</span><span class="op">)</span>, <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">0.5</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="va">hmm_ino</span><span class="op">$</span><span class="fu">optimize</span><span class="op">(</span>initial <span class="op">=</span> <span class="va">sampler</span>, runs <span class="op">=</span> <span class="fl">100</span>, label <span class="op">=</span> <span class="st">"random"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="educated-guesses">Educated guesses<a class="anchor" aria-label="anchor" href="#educated-guesses"></a>
</h3>
<p>For selecting fixed starting values, we consider sets of starting
values that fall in the ranges considered above. These can be considered
as “educated guesses” and are likely to be close to the global
optimum:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tpm_entry_1</span> <span class="op">&lt;-</span> <span class="va">tpm_entry_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="op">-</span><span class="fl">2.5</span><span class="op">)</span></span>
<span><span class="va">mu_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="op">-</span><span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="va">mu_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.05</span><span class="op">)</span></span>
<span><span class="va">sd_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.1</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">sd_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">0.75</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">starting_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/asplit.html" class="external-link">asplit</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span></span>
<span>  <span class="va">tpm_entry_1</span>, <span class="va">tpm_entry_2</span>, <span class="va">mu_1</span>, <span class="va">mu_2</span>, <span class="va">sd_1</span>, <span class="va">sd_2</span><span class="op">)</span>, </span>
<span>  MARGIN <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This grid results in a total of 64 starting values, which can be
specified as the <code>initial</code> argument:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hmm_ino</span><span class="op">$</span><span class="fu">optimize</span><span class="op">(</span>initial <span class="op">=</span> <span class="va">starting_values</span>, label <span class="op">=</span> <span class="st">"educated_guess"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="subset-initialization">Subset initialization<a class="anchor" aria-label="anchor" href="#subset-initialization"></a>
</h3>
<p>Since the data set is large, containing a total of 7475 share return
observations, it might be beneficial to obtain initial values by first
fitting the model to a data subset. If the data subset is chosen small
enough, estimation with the subset will be much faster. On the other
hand, if the data subset is chosen large enough to still contain enough
information, the estimates on the subset will already lie close to the
estimates for the full model.</p>
<p>To illustrate the subset initialization strategy, we consider the
first quarter of observations, which can be extracted using the
<code>$reduce()</code> method with arguments <code>how = "first"</code>
and <code>prop = 0.25</code>. The starting values for the optimizations
on this subset are drawn from the <code>sampler()</code> function
defined above. We again use <code>$optimize()</code> to fit the HMM, but
now to the data subset. With <code>$continue()</code>, we then use the
estimates obtained from the optimization on the subset as initial values
to fit the model to the entire data set. The entire data set is restored
via <code>$reset_argument("data")</code>.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;If we were to skip the &lt;code&gt;$reset_argument()&lt;/code&gt;
step, all future optimization runs would be made on the subset.&lt;/p&gt;"><sup>2</sup></a></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hmm_ino</span><span class="op">$</span></span>
<span>  <span class="fu">reduce</span><span class="op">(</span><span class="st">"data"</span>, how <span class="op">=</span> <span class="st">"first"</span>, prop <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span><span class="op">$</span></span>
<span>  <span class="fu">optimize</span><span class="op">(</span>initial <span class="op">=</span> <span class="va">sampler</span>, runs <span class="op">=</span> <span class="fl">100</span>, label <span class="op">=</span> <span class="st">"subset"</span><span class="op">)</span><span class="op">$</span></span>
<span>  <span class="fu">reset_argument</span><span class="op">(</span><span class="st">"data"</span><span class="op">)</span><span class="op">$</span></span>
<span>  <span class="fu">continue</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="standardize-initialization">Standardize initialization<a class="anchor" aria-label="anchor" href="#standardize-initialization"></a>
</h2>
<p>The considered log returns range from -0.1 to 0.1. Optimization might
be facilitated by standardizing the data first. This idea can be tested
via the <code>$standardize()</code> method:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hmm_ino</span><span class="op">$</span></span>
<span>  <span class="fu">standardize</span><span class="op">(</span><span class="st">"data"</span><span class="op">)</span><span class="op">$</span></span>
<span>  <span class="fu">optimize</span><span class="op">(</span>initial <span class="op">=</span> <span class="va">sampler</span>, runs <span class="op">=</span> <span class="fl">100</span>, label <span class="op">=</span> <span class="st">"standardize"</span><span class="op">)</span><span class="op">$</span></span>
<span>  <span class="fu">reset_argument</span><span class="op">(</span><span class="st">"data"</span><span class="op">)</span></span></code></pre></div>
<p>Note that we again use <code>$reset_argument()</code> to obtain our
actual (non-standardized) data set.</p>
</div>
<div class="section level2">
<h2 id="evaluating-the-optimization-runs">Evaluating the optimization runs<a class="anchor" aria-label="anchor" href="#evaluating-the-optimization-runs"></a>
</h2>
<div class="section level3">
<h3 id="global-versus-local-optima">Global versus local optima<a class="anchor" aria-label="anchor" href="#global-versus-local-optima"></a>
</h3>
<p>Selecting the starting values for the HMM likelihood optimization is
a well-known issue, as poor starting values may likely result in local
optima.<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Other R packages designed to fit HMMs discuss this topic
in more detail, see, e.g., &lt;span class="citation"&gt;Michelot, Langrock,
and Patterson (&lt;a href="#ref-Michelot:2016" role="doc-biblioref"&gt;2016&lt;/a&gt;)&lt;/span&gt;.&lt;/p&gt;'><sup>3</sup></a>
We thus first evaluate the optimizations by comparing the likelihood
values at convergence, which can be displayed using the
<code>$optima()</code> method. Here,</p>
<ul>
<li>
<code>sort_by = "value"</code> sorts the table by function value (in
decreasing order<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;By default, optimization is assumed to involve
minimizing the target function. If instead the function is maximized,
set &lt;code&gt;hmm_ino$minimized &amp;lt;- FALSE&lt;/code&gt; to reverse the ordering
in the &lt;code&gt;$optima()&lt;/code&gt; output.&lt;/p&gt;"><sup>4</sup></a>),</li>
<li>
<code>only_comparable = TRUE</code> excludes optimization results on
the standardized or reduced data set,</li>
<li>
<code>digitis = 0</code> ignores any decimal places.</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hmm_ino</span><span class="op">$</span><span class="fu">optima</span><span class="op">(</span>sort_by <span class="op">=</span> <span class="st">"value"</span>, only_comparable <span class="op">=</span> <span class="cn">TRUE</span>, digits <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span><span class="co">#&gt;    value frequency</span></span>
<span><span class="co">#&gt; 1 -22446        76</span></span>
<span><span class="co">#&gt; 2 -22445        40</span></span>
<span><span class="co">#&gt; 3 -21780         3</span></span>
<span><span class="co">#&gt; 4 -21372       144</span></span>
<span><span class="co">#&gt; 5 -21353         1</span></span></code></pre></div>
<p>The frequency table indicates that 76 out of 264 runs converged to
the smallest (negative) log-likelihood value, which appears to be the
global optimum (note that these are the negative log-likelihood values).
However, in 188 runs we apparantly got stuck in local optima.</p>
<p>Using <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code>, we now can investigate the optimum
values (<code>"value"</code>), the corresponding parameter vectors
(<code>"parameter"</code>), and the optimization times
(<code>"seconds"</code>) of all runs (here, only the first ten are
shown):<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;The &lt;code&gt;$elements_available()&lt;/code&gt; method provides
an overview of all available optimization result elements.&lt;/p&gt;"><sup>5</sup></a></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">hmm_ino</span>, which_element <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"value"</span>, <span class="st">"parameter"</span>, <span class="st">"seconds"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span>
<span><span class="co">#&gt;        value                                 parameter seconds</span></span>
<span><span class="co">#&gt; 1  -21372.14  -2.05, -18.88, 0.00, -2.35, -4.28, -4.64   12.81</span></span>
<span><span class="co">#&gt; 2  -22445.58    -3.70, -4.52, 0.00, 0.00, -4.72, -3.86   14.84</span></span>
<span><span class="co">#&gt; 3  -21372.14   -15.59, -2.08, 5.06, 0.00, -7.44, -4.28    9.57</span></span>
<span><span class="co">#&gt; 4  -22445.58    -3.70, -4.52, 0.00, 0.00, -4.72, -3.86   20.73</span></span>
<span><span class="co">#&gt; 5  -22445.58    -4.52, -3.70, 0.00, 0.00, -3.86, -4.72   21.37</span></span>
<span><span class="co">#&gt; 6  -21352.70 -15.92, -35.48, 14.12, 0.00, -8.09, -4.28   18.44</span></span>
<span><span class="co">#&gt; 7  -22445.58    -4.52, -3.70, 0.00, 0.00, -3.86, -4.72   32.38</span></span>
<span><span class="co">#&gt; 8  -21372.14 -30.36, -3.62, -22.03, 0.00, -4.71, -4.28   24.00</span></span>
<span><span class="co">#&gt; 9  -21372.13  -2.88, -13.94, 0.00, 1.46, -4.28, -12.26    8.39</span></span>
<span><span class="co">#&gt; 10 -22445.58    -3.70, -4.52, 0.00, 0.00, -4.72, -3.86   23.36</span></span></code></pre></div>
<p>The final parameter estimates (i.e., the parameters associated with
the global optimum) can be accessed via <code>$best_parameter()</code>
…</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hmm_ino</span><span class="op">$</span><span class="fu">best_parameter</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -3.70 -4.52  0.00  0.00 -4.72 -3.86</span></span>
<span><span class="co">#&gt; attr(,"run")</span></span>
<span><span class="co">#&gt; [1] 89</span></span>
<span><span class="co">#&gt; attr(,"optimizer")</span></span>
<span><span class="co">#&gt; [1] "stats::nlm"</span></span></code></pre></div>
<p>.. and the corresponding likelihood value as:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hmm_ino</span><span class="op">$</span><span class="fu">best_value</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -22445.58</span></span>
<span><span class="co">#&gt; attr(,"run")</span></span>
<span><span class="co">#&gt; [1] 89</span></span>
<span><span class="co">#&gt; attr(,"optimizer")</span></span>
<span><span class="co">#&gt; [1] "stats::nlm"</span></span></code></pre></div>
<p>Note that the attributes <code>"run"</code> and
<code>"optimizer"</code> provide the information, in which optimization
run and with which optimizer this estimate was obtained.</p>
<p>We can compute the proportion of runs that lead to the apparent
global optimum of -22445.58 as follows:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">hmm_ino</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"label"</span>, <span class="st">"value"</span>, <span class="st">"seconds"</span><span class="op">)</span>, global_optimum <span class="op">=</span> <span class="st">"value &lt; -22445"</span>, only_comparable <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">label</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>proportion <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">global_optimum</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 × 2</span></span></span>
<span><span class="co">#&gt;   label          proportion</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>               <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> educated_guess      0.562</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> random              0.4  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> subset              0.4</span></span></code></pre></div>
<p>While for the educated guesses about 55% of the runs converge to the
global optimum, the random initialization and subset initialization
strategies get stuck more often in local optima. Note that the
standardized initialization approach cannot be compared to the other
approaches here.</p>
</div>
<div class="section level3">
<h3 id="optimization-time">Optimization time<a class="anchor" aria-label="anchor" href="#optimization-time"></a>
</h3>
<p>The <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> function can be used to investigate the
optimization times across initialization strategies
(<code>by = "label"</code>).<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Setting &lt;code&gt;relative = FALSE&lt;/code&gt; in the
&lt;code&gt;&lt;a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link"&gt;plot()&lt;/a&gt;&lt;/code&gt; call shows the absolute times.&lt;/p&gt;'><sup>6</sup></a></p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">hmm_ino</span>, by <span class="op">=</span> <span class="st">"label"</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/hmm-optimization-time-1.png" width="75%" style="display: block; margin: auto;"></p>
<p>Using the output provided by <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> and some data
manipulation functions provided by the package <a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a>, we
can also compute summary statistics of interest, like the median
computation time or standard deviation per strategy:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">hmm_ino</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"label"</span>, <span class="st">"seconds"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">label</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    median_seconds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/median.html" class="external-link">median</a></span><span class="op">(</span><span class="va">seconds</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    sd_seconds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">seconds</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="va">median_seconds</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 3</span></span></span>
<span><span class="co">#&gt;   label          median_seconds sd_seconds</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> subset                   8.37       6.16</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> standardize              9.85       1.48</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> educated_guess          14.8        7.28</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> random                  15.9        7.30</span></span></code></pre></div>
<p>The subset and the standardize approach can improve the median
optimization time by a factor of about 2 in this example compared to the
random initialization approach.</p>
</div>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Michelot:2016" class="csl-entry">
Michelot, T., R. Langrock, and T. A. Patterson. 2016. <span>“<span class="nocase">moveHMM</span>: An <span>R</span> Package for the
Statistical Modelling of Animal Movement Data Using Hidden Markov
Models.”</span> <em>Methods in Ecology and Evolution</em> 7 (11):
1308–15. <a href="https://doi.org/10.1111/2041-210X.12578" class="external-link">https://doi.org/10.1111/2041-210X.12578</a>.
</div>
<div id="ref-Oelschläger:2021" class="csl-entry">
Oelschläger, L., and T. Adam. 2021. <span>“Detecting Bearish and Bullish
Markets in Financial Time Series Using Hierarchical Hidden Markov
Models.”</span> <em>Statistical Modelling</em>. <a href="https://doi.org/10.1177/1471082X211034048" class="external-link">https://doi.org/10.1177/1471082X211034048</a>.
</div>
<div id="ref-Oelschläger:2023b" class="csl-entry">
Oelschläger, L., T. Adam, and R. Michels. 2023. <em>fHMM: Fitting Hidden
Markov Models to Financial Data</em>. <a href="https://loelschlaeger.de/fHMM/" class="external-link">https://loelschlaeger.de/fHMM/</a>.
</div>
<div id="ref-Wickham:2023" class="csl-entry">
Wickham, H., R. François, L. Henry, K. Müller, and D. Vaughan. 2023.
<em><span class="nocase">dplyr</span>: A Grammar of Data
Manipulation</em>. <a href="https://CRAN.R-project.org/package=dplyr" class="external-link">https://CRAN.R-project.org/package=dplyr</a>.
</div>
<div id="ref-Zucchini:2016" class="csl-entry">
Zucchini, W., I. L. MacDonald, and R. Langrock. 2016. <em>Hidden
<span>Markov Models</span> for <span>Time Series</span>: <span>An
Introduction</span> <span>U</span>sing <span>R</span></em>. Boca Raton:
Chapman &amp; Hall/CRC.
</div>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://loelschlaeger.de" class="external-link">Lennart Oelschläger</a>, <a href="https://www.uni-bielefeld.de/fakultaeten/wirtschaftswissenschaften/lehrbereiche/stats/team/marius-otting-(m.sc.)/" class="external-link">Marius Ötting</a>, <a href="https://de.wikipedia.org/wiki/Dietmar_Bauer" class="external-link">Dietmar Bauer</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
