<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="ino">
<title>Example: Probit Model • ino</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Example: Probit Model">
<meta property="og:description" content="ino">
<meta property="og:image" content="https://loelschlaeger.de/ino/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">ino</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/example_hmm.html">Example: Hidden Markov Model</a>
    <a class="dropdown-item" href="../articles/example_probit.html">Example: Probit Model</a>
    <a class="dropdown-item" href="../articles/introduction.html">Introduction</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/loelschlaeger/ino/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Example: Probit Model</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/loelschlaeger/ino/blob/HEAD/vignettes/example_probit.Rmd" class="external-link"><code>vignettes/example_probit.Rmd</code></a></small>
      <div class="d-none name"><code>example_probit.Rmd</code></div>
    </div>

    
    
<p>The probit model is a widely employed statistical tool for analyzing
discrete choice behavior in various fields, including transportation
<span class="citation">(<a href="#ref-Bolduc:1999" role="doc-biblioref">Bolduc 1999</a>; <a href="#ref-Shin:2015" role="doc-biblioref">Shin et al. 2015</a>)</span> and marketing <span class="citation">(<a href="#ref-Allenby:1998" role="doc-biblioref">Allenby and Rossi 1998</a>; <a href="#ref-Haaijer:1998" role="doc-biblioref">Haaijer et al. 1998</a>;
<a href="#ref-Paap:2000" role="doc-biblioref">Paap and Franses
2000</a>)</span>. The estimation of probit model parameters typically
involves the numerical maximization of the likelihood function. However,
this approach can be computationally expensive and may encounter
problems in reaching the global optimum, especially when dealing with
complex models. In this vignette, we utilize the <a href="https://github.com/loelschlaeger/ino" class="external-link">ino</a>
package to investigate the influence of initialization on the numerical
maximization of the probit likelihood function.</p>
<div class="section level2">
<h2 id="model-formulation">Model formulation<a class="anchor" aria-label="anchor" href="#model-formulation"></a>
</h2>
<p>In our model formulation, we consider a scenario where a total of
<span class="math inline">\(N\)</span> deciders are faced with choosing
among <span class="math inline">\(J \geq 2\)</span> alternatives at each
of the <span class="math inline">\(T\)</span> choice occasions. The
choice made by decider <span class="math inline">\(n\)</span> at
occasion <span class="math inline">\(t\)</span> is denoted as <span class="math inline">\(y_{nt}\)</span> and can take values in the set
<span class="math inline">\(\{1, \dots, J\}\)</span>. For more
comprehensive details on the probit model and its estimation, please
refer to the works by <span class="citation">Train (<a href="#ref-Train:2009" role="doc-biblioref">2009</a>)</span> and <span class="citation">Bhat (<a href="#ref-Bhat:2011" role="doc-biblioref">2011</a>)</span>.</p>
<p>We assume that the choices are rational, meaning that the selected
alternative <span class="math inline">\(y_{nt}\)</span> corresponds to
the alternative with the highest utility among the available options.
The utility for decider <span class="math inline">\(n\)</span> at
occasion <span class="math inline">\(t\)</span> is represented by a
vector <span class="math inline">\(U_{nt} \in \mathbb{R}^J\)</span>,
where each entry of the vector corresponds to the utility associated
with a specific alternative. The probit model explains the utility
vector as <span class="math display">\[U_{nt} = X_{nt} b +
\epsilon_{nt},\]</span> where <span class="math inline">\(X_{nt}\)</span> is a <span class="math inline">\(J\times P\)</span> matrix containing <span class="math inline">\(P\)</span> characteristics for each alternative,
<span class="math inline">\(b\)</span> is a coefficient vector of length
<span class="math inline">\(P\)</span>, and <span class="math inline">\(\epsilon_{nt} \sim N(0,\Sigma)\)</span> denotes
the vector of jointly normally distributed errors, which capture
unobserved influences on the utility.</p>
<p>The probit model (like any utility model) is invariant to the level
and scale of the utilities <span class="math inline">\(U_{nt}\)</span>.
We ensure identifiability by considering utility differences, which
reduces <span class="math inline">\(\Sigma\)</span> from <span class="math inline">\(J\)</span> to <span class="math inline">\(J-1\)</span> dimensions, and fixing the first
entry of <span class="math inline">\(b\)</span> to <span class="math inline">\(1\)</span>.</p>
<p>To account for preference heterogeneity across decision-makers, the
mixed probit model incorporates decider-specific coefficient vectors as
<span class="math inline">\(\beta_n \sim N(b, \Omega)\)</span>. In the
degenerate case where <span class="math inline">\(\Omega = 0\)</span>,
all decision-makers share the same preferences, and <span class="math inline">\(\beta_n \equiv b\)</span>.</p>
<p>The goal of the researcher is to estimate the values for <span class="math inline">\(b\)</span>, <span class="math inline">\(\Omega\)</span>, and <span class="math inline">\(\Sigma\)</span> based on a set of observed choice
data. The most common approach for estimation is the maximum likelihood
method. Let <span class="math inline">\(\theta\)</span> represent the
vector of identified parameters, which includes <span class="math inline">\(P-1\)</span> coefficients of <span class="math inline">\(b\)</span>, <span class="math inline">\(P(P+1)/2\)</span> coefficients of <span class="math inline">\(\Omega\)</span>, and <span class="math inline">\(J(J-1)/2\)</span> coefficients of the differenced
matrix <span class="math inline">\(\Sigma\)</span>. To ensure that the
estimates result in proper covariance matrices, the optimization is
performed over the Cholesky factors. It is important to note that the
length of the parameter vector <span class="math inline">\(\theta\)</span> increases quadratically with both
the number of alternatives <span class="math inline">\(J\)</span> and
the number of choice characteristics <span class="math inline">\(P\)</span>, indicating that numerical optimization
becomes computationally demanding for complex models with a high number
of alternatives or choice covariates.</p>
<p>The maximum likelihood estimate <span class="math inline">\(\hat{\theta}\)</span> is obtained by solving <span class="math display">\[\hat{\theta} = \arg \max_\theta \log \sum_{n,t,j}
1(y_{nt} = j) \int 1(j = \arg \max U_{nt}) \phi(\epsilon_{nt}) d
\epsilon_{nt},\]</span> where <span class="math inline">\(1(\cdot)\)</span> denotes the indicator function
and <span class="math inline">\(\phi(\cdot)\)</span> represents the
Gaussian density. The integral part of the equation does not have a
closed-form expression, thus requiring numerical approximation. Here, we
utilize the <code><a href="https://rdrr.io/pkg/mvtnorm/man/algorithms.html" class="external-link">mvtnorm::GenzBretz()</a></code> algorithm by <span class="citation">Genz and Bretz (<a href="#ref-Genz:2009" role="doc-biblioref">2009</a>)</span> for this purpose.</p>
</div>
<div class="section level2">
<h2 id="data-simulation-and-likelihood-computation">Data simulation and likelihood computation<a class="anchor" aria-label="anchor" href="#data-simulation-and-likelihood-computation"></a>
</h2>
<p>The <a href="https://github.com/loelschlaeger/ino" class="external-link">ino</a> package provides the <code><a href="../reference/sim_mnp.html">sim_mnp()</a></code>
function, which enables simulation of choice data from a probit model.
Prior to utilizing this function, it is necessary to define the function
<code>X(n, t)</code>, which generates a matrix representing the choice
characteristics for decision maker <span class="math inline">\(n\)</span> at choice occasion <span class="math inline">\(t\)</span>. The matrix should have dimensions of
<span class="math inline">\(J \times P\)</span>, where <span class="math inline">\(J\)</span> corresponds to the number of available
alternatives, and <span class="math inline">\(P\)</span> indicates the
number of characteristics describing each alternative.</p>
<p>For our simulation, we have a choice setting with <span class="math inline">\(J = 3\)</span> alternatives, characterized by
<span class="math inline">\(P = 2\)</span> attributes. The values in the
first column of <span class="math inline">\(X_{nt}\)</span> are drawn
from a normal distribution <span class="math inline">\(\mathcal{N}(\mu =
10, \sigma = 3)\)</span>, while the values in the second column are
drawn from <span class="math inline">\(\mathcal{N}(\mu = 0, \sigma =
0.3)\)</span>. This design reflects the common situation of observing
choice covariates on different scales.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">X</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span>, <span class="va">t</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">J</span> <span class="op">&lt;-</span> <span class="fl">3</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">J</span>, mean <span class="op">=</span> <span class="fl">10</span>, sd <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>, <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="va">J</span>, mean <span class="op">=</span> <span class="fl">0</span>, sd <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="fu">X</span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span>, t <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="co">#&gt;           [,1]        [,2]</span></span>
<span><span class="co">#&gt; [1,]  8.120639  0.47858424</span></span>
<span><span class="co">#&gt; [2,] 10.550930  0.09885233</span></span>
<span><span class="co">#&gt; [3,]  7.493114 -0.24614052</span></span></code></pre></div>
<p>We simulate choice data for <span class="math inline">\(N =
200\)</span> deciders at <span class="math inline">\(T = 30\)</span>
choice occasions from the probit model defined by the parameter values
<span class="math inline">\(b = \begin{pmatrix} 1 &amp; -10
\end{pmatrix}^\top\)</span>, <span class="math inline">\(\Omega =
\begin{pmatrix} 0.2 &amp; 0.5 \\ 0.5 &amp; 2 \end{pmatrix}\)</span>, and
<span class="math inline">\(\Sigma = \begin{pmatrix} 1 &amp; -0.5 &amp;
0.2 \\ -0.5 &amp; 1 &amp; 0.2 \\ 0.2 &amp; 0.2 &amp; 1
\end{pmatrix}\)</span>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">200</span></span>
<span><span class="cn">T</span> <span class="op">&lt;-</span> <span class="fl">30</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">10</span><span class="op">)</span></span>
<span><span class="va">Omega</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, <span class="fl">2</span><span class="op">)</span>, <span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">Sigma</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="fl">0.2</span>, <span class="op">-</span><span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">1</span><span class="op">)</span>, <span class="fl">3</span>, <span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">probit_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_mnp.html">sim_mnp</a></span><span class="op">(</span><span class="va">N</span>, <span class="cn">T</span>, J <span class="op">=</span> <span class="fl">3</span>, P <span class="op">=</span> <span class="fl">2</span>, <span class="va">b</span>, <span class="va">Omega</span>, <span class="va">Sigma</span>, <span class="va">X</span>, seed <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>The <code>probit_data</code> object is a <code>data.frame</code> with
the decider index <code>n</code>, the choice occasion index
<code>t</code>, the choice <code>y</code>, and the choice
characteristics <code>X</code>:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">probit_data</span><span class="op">)</span></span>
<span><span class="co">#&gt;   n t y       X.11      X.21      X.31       X.12        X.22       X.32</span></span>
<span><span class="co">#&gt; 1 1 1 2 13.2233229 15.686964  8.191008 -0.1172603 -0.12486661 -0.1126972</span></span>
<span><span class="co">#&gt; 2 1 2 3  7.9073851  8.835497 11.957609  0.3374317 -0.23163324 -0.1524259</span></span>
<span><span class="co">#&gt; 3 1 3 3  5.7100197 15.127363 14.305209 -0.2131113 -0.01952027 -0.5278406</span></span>
<span><span class="co">#&gt; 4 1 4 1  7.6612945  8.076469  7.956606 -0.6099857  0.15028907 -0.4595394</span></span>
<span><span class="co">#&gt; 5 1 5 2 12.6760252  9.922855  8.057019  0.1939078 -0.13014982  0.5317834</span></span>
<span><span class="co">#&gt; 6 1 6 2  0.9758542  5.901664  8.727693  0.0710411 -0.70281694  0.2885090</span></span></code></pre></div>
<p>The <code>probit_data</code> object includes the attribute
<code>true</code>, which contains the true and <em>identified</em>
parameter values. These values consist of the mean effects <span class="math inline">\(b\)</span>, excluding the first element, the
elements <span class="math inline">\(o\)</span> of the lower-triangular
Cholesky root of <span class="math inline">\(\Omega\)</span>, and the
elements <span class="math inline">\(l\)</span> of the lower-triangular
Cholesky root of the differenced covariance matrix <span class="math inline">\(\Sigma\)</span> (with respect to alternative <span class="math inline">\(J\)</span>):</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="va">theta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">probit_data</span>, <span class="st">"true"</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span></span>
<span><span class="co">#&gt;    b.2   o.11   o.21   o.22   l.11   l.21   l.22 </span></span>
<span><span class="co">#&gt; -10.00   0.45   1.12   0.87   1.26   0.08   1.26</span></span></code></pre></div>
<p>The probit likelihood function is implemented as
<code><a href="../reference/f_ll_mnp.html">f_ll_mnp()</a></code> and can be evaluated by providing a parameter
vector <code>theta</code> and a data set <code>probit_data</code>:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/f_ll_mnp.html">f_ll_mnp</a></span><span class="op">(</span>theta <span class="op">=</span> <span class="va">theta</span>, data <span class="op">=</span> <span class="va">probit_data</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] -2153.488</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>To analyze the outcome of the numerical likelihood optimization for
the multinomial mixed probit model, we apply the <a href="https://github.com/loelschlaeger/ino" class="external-link">ino</a>
package:</p>
<ul>
<li>We first define a <code>Nop</code> object by setting the target
function <code>f = f_ll_mnp</code>, the number of parameters to
<code>npar = 7</code>, and <code>data = probit_data</code>.</li>
<li>Then, we apply the <code><a href="https://rdrr.io/r/stats/nlm.html" class="external-link">stats::nlm</a></code> optimizer with a limit of
1000 iterations. Since this optimizer minimizes the objective function
instead of maximizing it, we set <code>neg = TRUE</code> to compute the
negative log-likelihood value.</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">probit_ino</span> <span class="op">&lt;-</span> <span class="va"><a href="../reference/Nop.html">Nop</a></span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>f <span class="op">=</span> <span class="va">f_ll_mnp</span>, npar <span class="op">=</span> <span class="fl">7</span>, data <span class="op">=</span> <span class="va">probit_data</span>, neg <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">$</span></span>
<span>  <span class="fu">set_optimizer</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/optimizeR/man/define_optimizer.html" class="external-link">optimizer_nlm</a></span><span class="op">(</span>iterlim <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The true parameter vector <code>theta</code> is saved to assess the
convergence of the optimization runs to the global optimum:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">probit_ino</span><span class="op">$</span><span class="va">true_parameter</span> <span class="op">&lt;-</span> <span class="va">theta</span></span></code></pre></div>
<p>The initial <code>Nop</code> object looks as follows:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/print.html" class="external-link">print</a></span><span class="op">(</span><span class="va">probit_ino</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="text-decoration: underline;">Optimization problem:</span></span></span>
<span><span class="co">#&gt; - Function: f_ll_mnp</span></span>
<span><span class="co">#&gt; - Optimize over: theta (length 7) </span></span>
<span><span class="co">#&gt; - Additional arguments: data, neg </span></span>
<span><span class="co">#&gt; - True optimum at: -10 0.45 1.12 0.87 1.26 0.08 1.26 </span></span>
<span><span class="co">#&gt; - True optimum value: 696.44 </span></span>
<span><span class="co">#&gt; <span style="text-decoration: underline;">Numerical optimizer:</span></span></span>
<span><span class="co"><span style="text-decoration: underline;">#&gt; </span>- 1: stats::nlm </span></span>
<span><span class="co">#&gt; <span style="text-decoration: underline;">Optimization results:</span></span></span>
<span><span class="co"><span style="text-decoration: underline;">#&gt; </span>- Total runs (comparable): 400 (200)</span></span>
<span><span class="co">#&gt; - Best parameter: -10.49 -0.28 -2.81 0 1.37 0.04 -1.12</span></span>
<span><span class="co">#&gt; - Best value: 687.71</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="random-initialization">Random initialization<a class="anchor" aria-label="anchor" href="#random-initialization"></a>
</h2>
<p>As a benchmark, we optimize <code>runs = 100</code> times using
random initial values drawn from a standard normal distribution:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">probit_ino</span><span class="op">$</span><span class="fu">optimize</span><span class="op">(</span>initial <span class="op">=</span> <span class="st">"random"</span>, runs <span class="op">=</span> <span class="fl">100</span>, label <span class="op">=</span> <span class="st">"random"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="initializing-using-estimates-from-a-data-subsample">Initializing using estimates from a data subsample<a class="anchor" aria-label="anchor" href="#initializing-using-estimates-from-a-data-subsample"></a>
</h2>
<p>Next, we obtain starting values by estimating a probit model on a
subset of the data. In this example, we randomly select 20% of the data
points for the subset. Our aim is to initialize the full model close to
its global optimum by investing a small computational effort in
estimating the reduced model:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">probit_ino</span><span class="op">$</span></span>
<span>  <span class="fu">reduce</span><span class="op">(</span><span class="st">"data"</span>, how <span class="op">=</span> <span class="st">"random"</span>, proportion <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span><span class="op">$</span></span>
<span>  <span class="fu">optimize</span><span class="op">(</span>initial <span class="op">=</span> <span class="st">"random"</span>, runs <span class="op">=</span> <span class="fl">100</span>, label <span class="op">=</span> <span class="st">"subset"</span><span class="op">)</span><span class="op">$</span></span>
<span>  <span class="fu">reset_argument</span><span class="op">(</span><span class="st">"data"</span><span class="op">)</span><span class="op">$</span></span>
<span>  <span class="fu">continue</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>The <code>$reduce()</code> method offers additional options for
selecting the composition of the subset, which can further enhance the
initialization process:</p>
<ul>
<li><p><code>how = "first"</code> and <code>how = "last"</code>: These
options allow to select the subset from the beginning or the end of the
data, respectively, focusing on specific segments of the data
set.</p></li>
<li><p><code>how = "similar"</code> and <code>how = "dissimilar"</code>:
These options utilize k-means clustering to identify subsets of similar
or dissimilar data points. By clustering the data based on similarity, a
subset that represents a distinct group within the data set can be
selected. This approach can be particularly useful when there are
distinct patterns or characteristics within the data.</p></li>
</ul>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">probit_ino</span><span class="op">$</span><span class="fu">deviation</span><span class="op">(</span></span>
<span>  reference <span class="op">=</span> <span class="va">probit_ino</span><span class="op">$</span><span class="va">true_parameter</span>, which_run <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"random"</span>, <span class="st">"subset"</span><span class="op">)</span>,</span>
<span>  parameter_labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"b.2"</span>, <span class="st">"o.11"</span>, <span class="st">"o.21"</span>, <span class="st">"o.22"</span>, <span class="st">"l.11"</span>, <span class="st">"l.21"</span>, <span class="st">"l.22"</span><span class="op">)</span>  </span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Removed 14 rows containing missing values (`geom_point()`).</span></span></code></pre></div>
<p><img src="figures/probit-deviation-1.png" width="75%" style="display: block; margin: auto;"></p>
</div>
<div class="section level2">
<h2 id="estimation-with-standardized-covariates">Estimation with standardized covariates<a class="anchor" aria-label="anchor" href="#estimation-with-standardized-covariates"></a>
</h2>
<p>In choice settings, covariates can have varying scales, which can
result in differences in the magnitudes of model parameters. To enhance
numerical stability during estimation, a common strategy is to
standardize the covariates prior to the estimation. Here, we evaluate
the effectiveness of standardizing covariates using the
<code>$standardize()</code> method. By setting
<code>ignore = 1:3</code>, we exclude the first columns containing
indices from the standardization.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">probit_ino</span><span class="op">$</span></span>
<span>  <span class="fu">standardize</span><span class="op">(</span><span class="st">"data"</span>, by_column <span class="op">=</span> <span class="cn">TRUE</span>, ignore <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span><span class="op">$</span></span>
<span>  <span class="fu">optimize</span><span class="op">(</span>initial <span class="op">=</span> <span class="st">"random"</span>, runs <span class="op">=</span> <span class="fl">100</span>, label <span class="op">=</span> <span class="st">"standardized"</span><span class="op">)</span><span class="op">$</span></span>
<span>  <span class="fu">reset_argument</span><span class="op">(</span><span class="st">"data"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="results">Results<a class="anchor" aria-label="anchor" href="#results"></a>
</h2>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">probit_ino</span><span class="op">$</span><span class="fu">optima</span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">0</span>, which_run <span class="op">=</span> <span class="st">"random"</span><span class="op">)</span></span>
<span><span class="co">#&gt;   value frequency</span></span>
<span><span class="co">#&gt; 1   688        81</span></span>
<span><span class="co">#&gt; 2  &lt;NA&gt;         9</span></span>
<span><span class="co">#&gt; 3   689         5</span></span>
<span><span class="co">#&gt; 4   690         2</span></span>
<span><span class="co">#&gt; 5   814         1</span></span>
<span><span class="co">#&gt; 6  1234         1</span></span>
<span><span class="co">#&gt; 7  1886         1</span></span>
<span><span class="va">probit_ino</span><span class="op">$</span><span class="fu">optima</span><span class="op">(</span>digits <span class="op">=</span> <span class="fl">0</span>, which_run <span class="op">=</span> <span class="st">"subset"</span><span class="op">)</span></span>
<span><span class="co">#&gt;    value frequency</span></span>
<span><span class="co">#&gt; 1    688        64</span></span>
<span><span class="co">#&gt; 2    715         4</span></span>
<span><span class="co">#&gt; 3    713         3</span></span>
<span><span class="co">#&gt; 4    718         3</span></span>
<span><span class="co">#&gt; 5    689         2</span></span>
<span><span class="co">#&gt; 6    690         2</span></span>
<span><span class="co">#&gt; 7    692         2</span></span>
<span><span class="co">#&gt; 8    717         2</span></span>
<span><span class="co">#&gt; 9    759         2</span></span>
<span><span class="co">#&gt; 10  &lt;NA&gt;         2</span></span>
<span><span class="co">#&gt; 11   700         1</span></span>
<span><span class="co">#&gt; 12   721         1</span></span>
<span><span class="co">#&gt; 13   739         1</span></span>
<span><span class="co">#&gt; 14   740         1</span></span>
<span><span class="co">#&gt; 15   745         1</span></span>
<span><span class="co">#&gt; 16   747         1</span></span>
<span><span class="co">#&gt; 17   748         1</span></span>
<span><span class="co">#&gt; 18   750         1</span></span>
<span><span class="co">#&gt; 19   752         1</span></span>
<span><span class="co">#&gt; 20   753         1</span></span>
<span><span class="co">#&gt; 21   756         1</span></span>
<span><span class="co">#&gt; 22   757         1</span></span>
<span><span class="co">#&gt; 23   758         1</span></span>
<span><span class="co">#&gt; 24   760         1</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">probit_ino</span>, by <span class="op">=</span> <span class="st">"label"</span>, relative <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="figures/probit-times-1.png" width="75%" style="display: block; margin: auto;"></p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://dplyr.tidyverse.org" class="external-link">"dplyr"</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">probit_ino</span>, which_element <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"seconds"</span>, <span class="st">"label"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">label</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span></span>
<span>    mean_seconds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">seconds</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>    sd_seconds <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html" class="external-link">sd</a></span><span class="op">(</span><span class="va">seconds</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 4 × 3</span></span></span>
<span><span class="co">#&gt;   label               mean_seconds sd_seconds</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> random                     <span style="text-decoration: underline;">2</span>177.      <span style="text-decoration: underline;">1</span>589.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> standardized               <span style="text-decoration: underline;">1</span>442.       995.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> standardized_subset        <span style="text-decoration: underline;">1</span>038.       548.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> subset                     <span style="text-decoration: underline;">1</span>747.      <span style="text-decoration: underline;">1</span>024.</span></span></code></pre></div>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-Allenby:1998" class="csl-entry">
Allenby, G. M., and P. E. Rossi. 1998. <span>“Marketing Models of
Consumer Heterogeneity.”</span> <em>Journal of Econometrics</em> 89 (1):
57–78.
</div>
<div id="ref-Bhat:2011" class="csl-entry">
Bhat, C. 2011. <span>“The Maximum Approximate Composite Marginal
Likelihood (MACML) Estimation of Multinomial Probit-Based Unordered
Response Choice Models.”</span> <em>Transportation Research Part B:
Methodological</em> 45.
</div>
<div id="ref-Bolduc:1999" class="csl-entry">
Bolduc, D. 1999. <span>“A Practical Technique to Estimate Multinomial
Probit Models in Transportation.”</span> <em>Transportation Research
Part B: Methodological</em> 33 (1): 63–79.
</div>
<div id="ref-Genz:2009" class="csl-entry">
Genz, Alan, and Frank Bretz. 2009. <em>Computation of Multivariate
Normal and t Probabilities</em>. Vol. 195. Springer Science &amp;
Business Media.
</div>
<div id="ref-Haaijer:1998" class="csl-entry">
Haaijer, R., M. Wedel, M. Vriens, and T. Wansbeek. 1998. <span>“Utility
Covariances and Context Effects in Conjoint MNP Models.”</span>
<em>Marketing Science</em> 17 (3): 236–52.
</div>
<div id="ref-Paap:2000" class="csl-entry">
Paap, R., and P. H. Franses. 2000. <span>“A Dynamic Multinomial Probit
Model for Brand Choice with Different Long-Run and Short-Run Effects of
Marketing-Mix Variables.”</span> <em>Journal of Applied
Econometrics</em> 15 (6): 717–44.
</div>
<div id="ref-Shin:2015" class="csl-entry">
Shin, J., C. R. Bhat, D. You, V. M. Garikapati, and R. M. Pendyala.
2015. <span>“Consumer Preferences and Willingness to Pay for Advanced
Vehicle Technology Options and Fuel Types.”</span> <em>Transportation
Research Part C: Emerging Technologies</em> 60.
</div>
<div id="ref-Train:2009" class="csl-entry">
Train, K. 2009. <em>Discrete Choice Methods with Simulation</em>. 2. ed.
Cambridge Univ. Press.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by <a href="https://loelschlaeger.de" class="external-link">Lennart Oelschläger</a>, <a href="https://www.uni-bielefeld.de/fakultaeten/wirtschaftswissenschaften/lehrbereiche/stats/team/marius-otting-(m.sc.)/" class="external-link">Marius Ötting</a>, <a href="https://de.wikipedia.org/wiki/Dietmar_Bauer" class="external-link">Dietmar Bauer</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
